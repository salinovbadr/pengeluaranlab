<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengeluaran Lab - Puskesmas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #004990 0%, #0059b3 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
        }

        .header-title {
            font-size: 20px;
            font-weight: 500;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: white;
            color: #004990;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        /* Content Styles */
        .content {
            padding: 20px;
        }

        /* Menu Section */
        .menu-section {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .menu-header {
            padding: 15px 20px;
            background-color: #f9f9f9;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .menu-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
        }

        .menu-list {
            list-style: none;
        }

        .menu-item {
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:active {
            background-color: #f5f5f5;
        }

        .menu-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 20px;
            text-decoration: none;
            color: #1a1a1a;
            font-size: 16px;
        }

        .menu-arrow {
            color: #999;
            font-size: 18px;
        }

        /* Form Styles */
        .form-section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #555;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #004990;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #004990 0%, #0059b3 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 2px 8px rgba(233, 30, 99, 0.3);
        }

        .form-button:active {
            transform: scale(0.98);
        }

        .form-button.secondary {
            background: #999;
            box-shadow: none;
            margin-top: 10px;
        }

        .required {
            color: #f44336;
        }

        /* Patient Info Box */
        .patient-info-box {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-size: 14px;
        }

        .info-value {
            color: #1a1a1a;
            font-weight: 600;
            font-size: 14px;
            text-align: right;
        }

        /* Type Selection Cards */
        .type-selection {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .type-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .type-card:hover {
            border-color: #004990;
            background-color: #fff5f8;
        }

        .type-card.selected {
            border-color: #004990;
            background-color: #fff5f8;
        }

        .type-radio {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .type-info {
            flex: 1;
        }

        .type-title {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 4px;
        }

        .type-desc {
            font-size: 13px;
            color: #666;
        }

        /* Multi-select styles */
        .multi-select-wrapper {
            position: relative;
        }

        .multi-select-display {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            background-color: white;
            cursor: pointer;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .multi-select-display:hover {
            border-color: #004990;
        }

        .multi-select-placeholder {
            color: #999;
        }

        .multi-select-values {
            color: #1a1a1a;
            flex: 1;
            margin-right: 10px;
        }

        .multi-select-arrow {
            color: #666;
            font-size: 12px;
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: none;
        }

        .multi-select-dropdown.active {
            display: block;
        }

        .multi-select-option {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .multi-select-option:hover {
            background-color: #f5f5f5;
        }

        .multi-select-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Material List - Mobile Optimized */
        .material-section-title {
            font-size: 17px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 15px;
        }

        .material-category {
            margin-bottom: 20px;
        }

        .category-header {
            background: linear-gradient(135deg, #004990 0%, #0059b3 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 6px 6px 0 0;
            font-weight: 600;
            font-size: 14px;
        }

        .material-items {
            background-color: white;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 6px 6px;
        }

        .material-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
        }

        .material-item:last-child {
            border-bottom: none;
        }

        .material-name {
            font-size: 14px;
            color: #1a1a1a;
            font-weight: 500;
            line-height: 1.4;
        }

        .material-details {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .material-unit {
            font-size: 13px;
            color: #666;
            background-color: #f5f5f5;
            padding: 4px 10px;
            border-radius: 4px;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-label {
            font-size: 13px;
            color: #666;
            white-space: nowrap;
        }

        .quantity-input-group {
            display: flex;
            align-items: center;
            border: 1px solid #ddd;
            border-radius: 6px;
            overflow: hidden;
        }

        .qty-btn {
            background-color: #f5f5f5;
            border: none;
            padding: 8px 12px;
            font-size: 18px;
            color: #004990;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .qty-btn:active {
            background-color: #e0e0e0;
        }

        .quantity-input {
            width: 60px;
            padding: 8px;
            border: none;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
            -moz-appearance: textfield;
        }

        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .quantity-input:focus {
            outline: none;
            background-color: #fff5f8;
        }

        .delete-material-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #f44336;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 18px;
            line-height: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding: 0 10px;
        }

        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
            transition: all 0.3s;
            z-index: 2;
        }

        .step-item.active .step-number {
            background: linear-gradient(135deg, #004990 0%, #0059b3 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(233, 30, 99, 0.4);
        }

        .step-item.completed .step-number {
            background-color: #4CAF50;
            color: white;
        }

        .step-label {
            font-size: 11px;
            color: #999;
            text-align: center;
            font-weight: 500;
        }

        .step-item.active .step-label {
            color: #004990;
            font-weight: 600;
        }

        .step-item.completed .step-label {
            color: #4CAF50;
        }

        .step-line {
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .step-item.completed .step-line {
            background-color: #4CAF50;
        }

        .step-item:last-child .step-line {
            display: none;
        }

        /* Add Material Button */
        .add-material-btn {
            width: 100%;
            padding: 12px;
            background-color: #f5f5f5;
            border: 2px dashed #ddd;
            border-radius: 6px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s;
        }

        .add-material-btn:hover {
            background-color: #fff5f8;
            border-color: #004990;
            color: #004990;
        }

        .add-material-btn:active {
            transform: scale(0.98);
        }

        /* Modal/Popup Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        .modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin: 0;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-btn-cancel {
            background-color: #f5f5f5;
            color: #666;
        }

        .modal-btn-cancel:active {
            background-color: #e0e0e0;
        }

        .modal-btn-confirm {
            background: linear-gradient(135deg, #004990 0%, #0059b3 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(233, 30, 99, 0.3);
        }

        .modal-btn-confirm:active {
            transform: scale(0.98);
        }

        .summary-section {
            margin-bottom: 15px;
        }

        .summary-title {
            font-size: 14px;
            font-weight: 600;
            color: #004990;
            margin-bottom: 8px;
        }

        .summary-text {
            font-size: 13px;
            color: #666;
            line-height: 1.6;
        }

        .summary-highlight {
            color: #1a1a1a;
            font-weight: 600;
        }

        /* Input Modal for Add Material */
        .input-group {
            margin-bottom: 15px;
        }

        .input-label {
            display: block;
            font-size: 13px;
            color: #555;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .modal-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .modal-input:focus {
            outline: none;
            border-color: #004990;
        }

        /* History Page Styles */
        .history-container {
            padding: 20px;
        }

        .search-filter-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .search-box {
            position: relative;
            margin-bottom: 12px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 18px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
        }

        .search-input:focus {
            outline: none;
            border-color: #004990;
        }

        .filter-row {
            display: flex;
            gap: 10px;
        }

        .filter-select {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .filter-select:focus {
            outline: none;
            border-color: #004990;
        }

        /* History Cards */
        .history-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .history-card:active {
            transform: scale(0.98);
        }

        .card-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .card-title-section {
            flex: 1;
        }

        .card-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .badge-sampel {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-control {
            background: #fff3e0;
            color: #f57c00;
        }

        .badge-alat {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .card-datetime {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }

        .card-divider {
            height: 1px;
            background: #f0f0f0;
            margin: 10px 0;
        }

        .card-info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 14px;
        }

        .card-label {
            color: #666;
        }

        .card-value {
            color: #1a1a1a;
            font-weight: 500;
            text-align: right;
        }

        .card-footer {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }

        .view-detail-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #004990 0%, #0059b3 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .view-detail-btn:active {
            transform: scale(0.98);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-state-subtext {
            font-size: 14px;
        }

        /* Detail Modal Styles */
        .detail-modal-content {
            max-height: 85vh;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #004990;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #004990;
        }

        .detail-row {
            display: flex;
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            width: 120px;
            flex-shrink: 0;
            font-size: 13px;
            color: #666;
        }

        .detail-value {
            flex: 1;
            font-size: 13px;
            color: #1a1a1a;
            font-weight: 500;
        }

        .detail-list {
            list-style: none;
            padding: 0;
            margin: 8px 0 0 0;
        }

        .detail-list li {
            padding: 6px 0;
            font-size: 13px;
            color: #1a1a1a;
            display: flex;
            align-items: flex-start;
        }

        .detail-list li:before {
            content: "‚Ä¢";
            color: #004990;
            font-weight: bold;
            margin-right: 8px;
        }

        .material-collapse-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 10px 0;
        }

        .material-collapse-header:hover {
            color: #004990;
        }

        .collapse-arrow {
            transition: transform 0.3s;
            font-size: 12px;
        }

        .collapse-arrow.collapsed {
            transform: rotate(-90deg);
        }

        .material-collapse-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .material-collapse-content.expanded {
            max-height: 1000px;
        }

        .badge-type-large {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <button class="back-btn" onclick="goBack()">‚Üê</button>
            <div class="header-title" id="pageTitle">Inventaris</div>
        </div>
        <div class="header-right">
            <div class="user-avatar">IM</div>
        </div>
    </div>

    <!-- Content -->
    <div class="content">
        <!-- Inventory Menu -->
        <div class="menu-section" id="inventoryMenu">
            <div class="menu-header">
                <span class="menu-title">Inventaris</span>
            </div>
            <ul class="menu-list">
                <li class="menu-item">
                    <a href="#" class="menu-link" onclick="showPage('labDistribution'); return false;">
                        <span>Pengeluaran Lab</span>
                        <span class="menu-arrow">‚Ä∫</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" onclick="showPage('riwayatPengeluaran'); return false;">
                        <span>Riwayat Pengeluaran Lab</span>
                        <span class="menu-arrow">‚Ä∫</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Lab Distribution Form (Initially Hidden) -->
        <div class="form-section" id="labDistributionForm" style="display: none;">
            
            <!-- Step 0: Pilih Tipe Pengeluaran -->
            <div id="step0Section">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step-item active">
                        <div class="step-number">1</div>
                        <div class="step-label">Tipe</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-label">Pemeriksaan</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-label">Material</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Tipe Pengeluaran <span class="required">*</span></label>
                    <div class="type-selection">
                        <div class="type-card" onclick="selectType('sampel')">
                            <input type="radio" name="tipeOutput" value="sampel" class="type-radio" id="typeSampel">
                            <div class="type-info">
                                <div class="type-title">Sampel</div>
                                <div class="type-desc">Pemeriksaan dengan data pasien (NIK required)</div>
                            </div>
                        </div>
                        <div class="type-card" onclick="selectType('control')">
                            <input type="radio" name="tipeOutput" value="control" class="type-radio" id="typeControl">
                            <div class="type-info">
                                <div class="type-title">Control</div>
                                <div class="type-desc">Kontrol kualitas tanpa data pasien</div>
                            </div>
                        </div>
                        <div class="type-card" onclick="selectType('alat')">
                            <input type="radio" name="tipeOutput" value="alat" class="type-radio" id="typeAlat">
                            <div class="type-info">
                                <div class="type-title">Alat</div>
                                <div class="type-desc">Pengeluaran alat laboratorium</div>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="form-button" onclick="goToStep1()">Lanjutkan</button>
            </div>

            <!-- Step 1: NIK & Data Pasien (Only for Sampel) -->
            <div id="step1Section" style="display: none;">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Tipe</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item active">
                        <div class="step-number">2</div>
                        <div class="step-label">Data Pasien</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-label">Pemeriksaan</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-label">Material</div>
                    </div>
                </div>

                <form id="step1Form">
                    <div class="form-group">
                        <label class="form-label">NIK <span class="required">*</span></label>
                        <input type="text" id="nikInput" class="form-input" placeholder="Masukkan NIK (16 digit)" maxlength="16" pattern="[0-9]{16}" required>
                        <div id="nikError" style="color: #f44336; font-size: 13px; margin-top: 5px; display: none;">
                            NIK tidak valid atau tidak ditemukan dalam database wilayah
                        </div>
                    </div>

                    <!-- Auto-filled Patient Info -->
                    <div id="patientInfoBox" style="display: none;">
                        <div class="patient-info-box">
                            <div class="info-row">
                                <span class="info-label">Jenis Kelamin</span>
                                <span class="info-value" id="patientGender">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Tanggal Lahir</span>
                                <span class="info-value" id="patientBirthDate">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Usia</span>
                                <span class="info-value" id="patientAge">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Provinsi</span>
                                <span class="info-value" id="patientProvince">-</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Kab/Kota</span>
                                <span class="info-value" id="patientCity">-</span>
                            </div>
                        </div>

                        <!-- Nama field -->
                        <div class="form-group">
                            <label class="form-label">Nama Lengkap <span class="required">*</span></label>
                            <input type="text" class="form-input" id="namaInput" placeholder="Masukkan nama lengkap pasien" required>
                        </div>

                        <!-- Additional form fields -->
                        <div class="form-group">
                            <label class="form-label">Kecamatan <span class="required">*</span></label>
                            <select class="form-select" id="kecamatanSelect" required>
                                <option value="">Pilih Kecamatan</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Alamat Lengkap <span class="required">*</span></label>
                            <textarea class="form-textarea" id="alamatInput" placeholder="Nama jalan, RT/RW, kelurahan/desa" required></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">No. Telepon <span class="required">*</span></label>
                            <input type="tel" class="form-input" id="teleponInput" placeholder="08xxxxxxxxxx" pattern="[0-9]{10,13}" required>
                        </div>

                        <button type="button" class="form-button" onclick="goToStep2()">Lanjutkan</button>
                    </div>
                </form>
            </div>

            <!-- Step 2: Lab Examination Selection -->
            <div id="step2Section" style="display: none;">
                <!-- Step Indicator (will be updated dynamically) -->
                <div class="step-indicator" id="step2Indicator"></div>

                <form id="step2Form">
                    <div class="form-group">
                        <label class="form-label">Pemeriksaan <span class="required">*</span></label>
                        <select class="form-select" id="pemeriksaanSelect" required onchange="updateParameterOptions()">
                            <option value="">Pilih jenis pemeriksaan</option>
                            <option value="Hematologi">Hematologi</option>
                            <option value="Kimia Darah">Kimia Darah</option>
                            <option value="Urinalisis">Urinalisis</option>
                            <option value="Mikrobiologi">Mikrobiologi</option>
                            <option value="Serologi">Serologi</option>
                            <option value="Imunologi">Imunologi</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Parameter <span class="required">*</span></label>
                        <div class="multi-select-wrapper">
                            <div class="multi-select-display" id="parameterDisplay" onclick="toggleParameterDropdown()">
                                <span class="multi-select-placeholder" id="parameterPlaceholder">Pilih parameter (bisa lebih dari 1)</span>
                                <span class="multi-select-values" id="parameterValues" style="display: none;"></span>
                                <span class="multi-select-arrow">‚ñº</span>
                            </div>
                            <div class="multi-select-dropdown" id="parameterDropdown">
                                <!-- Will be populated dynamically -->
                            </div>
                            <input type="hidden" id="parameterHidden" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Sampel <span class="required">*</span></label>
                        <select class="form-select" id="sampelSelect" required>
                            <option value="">Pilih jenis sampel</option>
                            <option value="Darah Kapiler">Darah Kapiler</option>
                            <option value="Darah Vena">Darah Vena</option>
                            <option value="Urine">Urine</option>
                            <option value="Feses">Feses</option>
                            <option value="Dahak">Dahak</option>
                            <option value="Swab">Swab</option>
                            <option value="Cairan Tubuh">Cairan Tubuh</option>
                        </select>
                    </div>

                    <button type="button" class="form-button" onclick="goToStep3()">Lanjutkan</button>
                    <button type="button" class="form-button secondary" onclick="backFromStep2()">Kembali</button>
                </form>
            </div>

            <!-- Step 3: Material List -->
            <div id="step3Section" style="display: none;">
                <!-- Step Indicator (will be updated dynamically) -->
                <div class="step-indicator" id="step3Indicator"></div>

                <h3 class="material-section-title">Daftar Material</h3>
                
                <div id="materialListContainer">
                    <!-- Will be populated by JavaScript -->
                </div>

                <button type="button" class="form-button" onclick="handleSubmit()">Simpan Data</button>
                <button type="button" class="form-button secondary" onclick="backFromStep3()">Kembali</button>
            </div>
        </div>

        <!-- Riwayat Pengeluaran Lab (Initially Hidden) -->
        <div id="riwayatPengeluaranSection" style="display: none;">
            <div class="history-container">
                <!-- Search & Filter -->
                <div class="search-filter-section">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" id="searchInput" placeholder="Cari NIK atau Nama pasien..." onkeyup="filterHistory()">
                    </div>
                    <div class="filter-row">
                        <select class="filter-select" id="filterType" onchange="filterHistory()">
                            <option value="">Semua Tipe</option>
                            <option value="sampel">Sampel</option>
                            <option value="control">Control</option>
                            <option value="alat">Alat</option>
                        </select>
                        <select class="filter-select" id="filterDate" onchange="filterHistory()">
                            <option value="">Semua Waktu</option>
                            <option value="today">Hari Ini</option>
                            <option value="yesterday">Kemarin</option>
                            <option value="7days">7 Hari Terakhir</option>
                            <option value="30days">30 Hari Terakhir</option>
                        </select>
                    </div>
                </div>

                <!-- History Cards Container -->
                <div id="historyCardsContainer">
                    <!-- Cards will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Detail Pengeluaran -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal-content detail-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detail Pengeluaran Lab</h3>
            </div>
            <div class="modal-body" id="detailModalBody">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="modal-btn modal-btn-cancel" onclick="closeDetailModal()" style="width: 100%;">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Modal: Add Material -->
    <div class="modal-overlay" id="addMaterialModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Tambah Material</h3>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label class="input-label">Kategori <span class="required">*</span></label>
                    <select class="modal-input" id="newMaterialCategory" onchange="updateMaterialOptions()">
                        <option value="">Pilih Kategori</option>
                        <option value="BMHP">BMHP</option>
                        <option value="Reagen">Reagen</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Nama Material <span class="required">*</span></label>
                    <select class="modal-input" id="newMaterialName" onchange="updateMaterialUnit()" disabled>
                        <option value="">Pilih material terlebih dahulu</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Satuan <span class="required">*</span></label>
                    <input type="text" class="modal-input" id="newMaterialUnit" placeholder="Otomatis terisi" readonly style="background-color: #f5f5f5; cursor: not-allowed;">
                </div>
                <div class="input-group">
                    <label class="input-label">Jumlah <span class="required">*</span></label>
                    <input type="number" class="modal-input" id="newMaterialQty" placeholder="0" min="0" step="0.01">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="modal-btn modal-btn-cancel" onclick="closeAddMaterialModal()">Batal</button>
                <button type="button" class="modal-btn modal-btn-confirm" onclick="addNewMaterial()">Tambahkan</button>
            </div>
        </div>
    </div>

    <!-- Modal: Confirmation -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Konfirmasi Penyimpanan Data</h3>
            </div>
            <div class="modal-body" id="confirmModalBody">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="modal-btn modal-btn-cancel" onclick="closeConfirmModal()">Batal</button>
                <button type="button" class="modal-btn modal-btn-confirm" onclick="confirmSubmit()">Ya, Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // Master Material Database (dari Admin)
        const masterMaterialDatabase = {
            'BMHP': [
                { nama: 'Alcohol swab 70%', satuan: 'pcs' },
                { nama: 'Disposable lancet 28G', satuan: 'pcs' },
                { nama: 'Disposable lancet 21G', satuan: 'pcs' },
                { nama: 'Kapas steril', satuan: 'pcs' },
                { nama: 'Kapas alkohol', satuan: 'pcs' },
                { nama: 'Kasa steril', satuan: 'pcs' },
                { nama: 'Object glass', satuan: 'pcs' },
                { nama: 'Cover glass', satuan: 'pcs' },
                { nama: 'Spuit 1cc', satuan: 'pcs' },
                { nama: 'Spuit 3cc', satuan: 'pcs' },
                { nama: 'Spuit 5cc', satuan: 'pcs' },
                { nama: 'Spuit 10cc', satuan: 'pcs' },
                { nama: 'Vacutainer EDTA 3ml', satuan: 'pcs' },
                { nama: 'Vacutainer clot activator 3ml', satuan: 'pcs' },
                { nama: 'Vacutainer heparin 3ml', satuan: 'pcs' },
                { nama: 'Pot urine steril 50ml', satuan: 'pcs' },
                { nama: 'Pot dahak steril 50ml', satuan: 'pcs' },
                { nama: 'Pot feses steril 50ml', satuan: 'pcs' },
                { nama: 'Tabung centrifuge 10ml', satuan: 'pcs' },
                { nama: 'Tabung centrifuge 15ml', satuan: 'pcs' },
                { nama: 'Pipet tetes', satuan: 'pcs' },
                { nama: 'Pipet mikro', satuan: 'pcs' },
                { nama: 'Tips pipet kuning', satuan: 'pcs' },
                { nama: 'Tips pipet biru', satuan: 'pcs' },
                { nama: 'Cawan petri steril', satuan: 'pcs' },
                { nama: 'Swab steril', satuan: 'pcs' },
                { nama: 'Media transport Stuart', satuan: 'pcs' },
                { nama: 'Media transport Amies', satuan: 'pcs' },
                { nama: 'Ose bulat steril', satuan: 'pcs' },
                { nama: 'Ose lurus steril', satuan: 'pcs' },
                { nama: 'Ose kalibrasi 0.001ml', satuan: 'pcs' },
                { nama: 'Plester hypoallergenic', satuan: 'pcs' },
                { nama: 'Plester kertas', satuan: 'pcs' },
                { nama: 'Tourniquet', satuan: 'pcs' },
                { nama: 'Sarung tangan pemeriksaan M', satuan: 'pasang' },
                { nama: 'Sarung tangan pemeriksaan L', satuan: 'pasang' },
                { nama: 'Sarung tangan steril no. 6.5', satuan: 'pasang' },
                { nama: 'Sarung tangan steril no. 7', satuan: 'pasang' },
                { nama: 'Sarung tangan steril no. 7.5', satuan: 'pasang' },
                { nama: 'Masker 3 ply', satuan: 'pcs' },
                { nama: 'Masker N95', satuan: 'pcs' },
                { nama: 'Label spesimen', satuan: 'pcs' },
                { nama: 'Botol kultur darah aerob', satuan: 'pcs' },
                { nama: 'Botol kultur darah anaerob', satuan: 'pcs' },
                { nama: 'Kuvet fotometer', satuan: 'pcs' },
                { nama: 'Tabung reaksi', satuan: 'pcs' },
                { nama: 'Rak tabung', satuan: 'pcs' },
                { nama: 'Beaker glass 50ml', satuan: 'pcs' },
                { nama: 'Beaker glass 100ml', satuan: 'pcs' },
                { nama: 'Beaker glass 250ml', satuan: 'pcs' }
            ],
            'Reagen': [
                { nama: 'Larutan Giemsa', satuan: 'ml' },
                { nama: 'Methanol', satuan: 'ml' },
                { nama: 'Buffer pH 7.2', satuan: 'ml' },
                { nama: 'Aquadest steril', satuan: 'ml' },
                { nama: 'NaCl 0.9%', satuan: 'ml' },
                { nama: 'Hematology Control', satuan: 'ml' },
                { nama: 'Hematology Lyse', satuan: 'ml' },
                { nama: 'Hematology Clean', satuan: 'ml' },
                { nama: 'Hematology Diluent', satuan: 'ml' },
                { nama: 'Reagen glukosa GOD-PAP', satuan: 'ml' },
                { nama: 'Reagen kolesterol CHOD-PAP', satuan: 'ml' },
                { nama: 'Reagen trigliserida GPO-PAP', satuan: 'ml' },
                { nama: 'Reagen HDL cholesterol', satuan: 'ml' },
                { nama: 'Reagen LDL cholesterol', satuan: 'ml' },
                { nama: 'Reagen asam urat', satuan: 'ml' },
                { nama: 'Reagen ureum', satuan: 'ml' },
                { nama: 'Reagen kreatinin', satuan: 'ml' },
                { nama: 'Reagen SGOT/AST', satuan: 'ml' },
                { nama: 'Reagen SGPT/ALT', satuan: 'ml' },
                { nama: 'Reagen bilirubin total', satuan: 'ml' },
                { nama: 'Reagen bilirubin direk', satuan: 'ml' },
                { nama: 'Reagen protein total', satuan: 'ml' },
                { nama: 'Reagen albumin', satuan: 'ml' },
                { nama: 'Strip glukosa', satuan: 'pcs' },
                { nama: 'Strip asam urat', satuan: 'pcs' },
                { nama: 'Strip kolesterol', satuan: 'pcs' },
                { nama: 'Urine strip 10 parameter', satuan: 'pcs' },
                { nama: 'Larutan SSA 20%', satuan: 'ml' },
                { nama: 'Asam asetat 3%', satuan: 'ml' },
                { nama: 'Asam sulfosalisilat', satuan: 'ml' },
                { nama: 'Blood agar plate', satuan: 'pcs' },
                { nama: 'Mac Conkey agar', satuan: 'pcs' },
                { nama: 'CLED agar', satuan: 'pcs' },
                { nama: 'Chocolate agar', satuan: 'pcs' },
                { nama: 'Lowenstein-Jensen medium', satuan: 'pcs' },
                { nama: 'Mueller Hinton agar', satuan: 'pcs' },
                { nama: 'Crystal violet (pewarna gram)', satuan: 'ml' },
                { nama: 'Lugol (pewarna gram)', satuan: 'ml' },
                { nama: 'Alkohol 95% (pewarna gram)', satuan: 'ml' },
                { nama: 'Safranin (pewarna gram)', satuan: 'ml' },
                { nama: 'Ziehl-Neelsen carbol fuchsin', satuan: 'ml' },
                { nama: 'Asam alkohol 3%', satuan: 'ml' },
                { nama: 'Methylen blue', satuan: 'ml' },
                { nama: 'Disk antibiotik Ampicillin', satuan: 'pcs' },
                { nama: 'Disk antibiotik Amoxicillin', satuan: 'pcs' },
                { nama: 'Disk antibiotik Ciprofloxacin', satuan: 'pcs' },
                { nama: 'Disk antibiotik Ceftriaxone', satuan: 'pcs' },
                { nama: 'Disk antibiotik Gentamicin', satuan: 'pcs' },
                { nama: 'Disk antibiotik (set lengkap)', satuan: 'set' },
                { nama: 'Rapid test HIV', satuan: 'pcs' },
                { nama: 'Rapid test HBsAg', satuan: 'pcs' },
                { nama: 'Rapid test Anti HBs', satuan: 'pcs' },
                { nama: 'Rapid test Anti HCV', satuan: 'pcs' },
                { nama: 'Rapid test Dengue NS1', satuan: 'pcs' },
                { nama: 'Rapid test Dengue IgG/IgM', satuan: 'pcs' },
                { nama: 'Rapid test Malaria', satuan: 'pcs' },
                { nama: 'Rapid test Typhoid', satuan: 'pcs' },
                { nama: 'Rapid test Syphilis', satuan: 'pcs' },
                { nama: 'VDRL antigen', satuan: 'test' },
                { nama: 'TPHA antigen', satuan: 'test' },
                { nama: 'Widal antigen O', satuan: 'test' },
                { nama: 'Widal antigen H', satuan: 'test' },
                { nama: 'IgE test kit', satuan: 'test' },
                { nama: 'ANA test kit', satuan: 'test' },
                { nama: 'RF test kit', satuan: 'test' },
                { nama: 'CRP test kit', satuan: 'test' },
                { nama: 'Complement C3/C4 kit', satuan: 'test' },
                { nama: 'Buffer/diluent universal', satuan: 'ml' },
                { nama: 'Media kultur otomatis', satuan: 'ml' },
                { nama: 'H2O2 (Hidrogen Peroksida) 3%', satuan: 'ml' },
                { nama: 'Alkohol 70%', satuan: 'ml' },
                { nama: 'Formalin 10%', satuan: 'ml' }
            ]
        };

        // Database wilayah Indonesia (Jakarta dan Jawa Barat)
        const wilayahData = {
            '31': { 
                name: 'DKI Jakarta', 
                cities: {
                    '71': { name: 'Jakarta Pusat', kecamatan: ['Gambir', 'Tanah Abang', 'Menteng', 'Senen', 'Cempaka Putih', 'Johar Baru', 'Kemayoran', 'Sawah Besar'] },
                    '72': { name: 'Jakarta Utara', kecamatan: ['Penjaringan', 'Tanjung Priok', 'Koja', 'Cilincing', 'Pademangan', 'Kelapa Gading'] },
                    '73': { name: 'Jakarta Barat', kecamatan: ['Cengkareng', 'Grogol Petamburan', 'Taman Sari', 'Tambora', 'Kebon Jeruk', 'Kalideres', 'Palmerah', 'Kembangan'] },
                    '74': { name: 'Jakarta Selatan', kecamatan: ['Kebayoran Baru', 'Kebayoran Lama', 'Pesanggrahan', 'Cilandak', 'Pasar Minggu', 'Jagakarsa', 'Mampang Prapatan', 'Pancoran', 'Tebet'] },
                    '75': { name: 'Jakarta Timur', kecamatan: ['Matraman', 'Pulogadung', 'Jatinegara', 'Cakung', 'Duren Sawit', 'Kramat Jati', 'Makasar', 'Pasar Rebo', 'Ciracas', 'Cipayung'] }
                }
            },
            '32': { 
                name: 'Jawa Barat', 
                cities: {
                    '71': { name: 'Bogor', kecamatan: ['Bogor Selatan', 'Bogor Timur', 'Bogor Utara', 'Bogor Tengah', 'Bogor Barat', 'Tanah Sareal'] },
                    '73': { name: 'Bandung', kecamatan: ['Bandung Wetan', 'Sumur Bandung', 'Cibeunying Kidul', 'Cibeunying Kaler', 'Coblong', 'Sukasari', 'Cicendo', 'Sukajadi', 'Cidadap', 'Andir'] },
                    '75': { name: 'Bekasi', kecamatan: ['Bekasi Barat', 'Bekasi Selatan', 'Bekasi Timur', 'Bekasi Utara', 'Bantargebang', 'Jatiasih', 'Jatisampurna', 'Medan Satria', 'Mustika Jaya', 'Pondok Gede', 'Pondok Melati', 'Rawalumbu'] },
                    '76': { name: 'Depok', kecamatan: ['Beji', 'Cimanggis', 'Cinere', 'Cipayung', 'Limo', 'Pancoran Mas', 'Sawangan', 'Sukmajaya', 'Tapos', 'Bojongsari', 'Cilodong'] },
                    '77': { name: 'Cimahi', kecamatan: ['Cimahi Selatan', 'Cimahi Tengah', 'Cimahi Utara'] }
                }
            }
        };

        // Parameter database berdasarkan jenis pemeriksaan
        const parameterDatabase = {
            'Hematologi': [
                'Hemoglobin (Hb)',
                'Hematokrit (Ht)',
                'Eritrosit',
                'Leukosit',
                'Trombosit',
                'Hitung Jenis Leukosit',
                'LED (Laju Endap Darah)',
                'Retikulosit',
                'Masa Perdarahan',
                'Masa Pembekuan'
            ],
            'Kimia Darah': [
                'Glukosa Puasa',
                'Glukosa Sewaktu',
                'Glukosa 2 Jam PP',
                'HbA1c',
                'Kolesterol Total',
                'Kolesterol HDL',
                'Kolesterol LDL',
                'Trigliserida',
                'Asam Urat',
                'Ureum',
                'Kreatinin',
                'SGOT (AST)',
                'SGPT (ALT)',
                'Bilirubin Total',
                'Bilirubin Direk'
            ],
            'Urinalisis': [
                'Warna',
                'Kejernihan',
                'pH',
                'Berat Jenis',
                'Protein',
                'Glukosa',
                'Keton',
                'Bilirubin',
                'Urobilinogen',
                'Darah Samar',
                'Nitrit',
                'Leukosit Esterase',
                'Sedimen Urine'
            ],
            'Mikrobiologi': [
                'Kultur Darah',
                'Kultur Urine',
                'Kultur Feses',
                'Kultur Sputum',
                'Kultur Swab',
                'Pewarnaan Gram',
                'Tes Kepekaan Antibiotik',
                'BTA (Basil Tahan Asam)',
                'Pewarnaan Ziehl-Neelsen'
            ],
            'Serologi': [
                'HIV',
                'HBsAg',
                'Anti HBs',
                'Anti HCV',
                'VDRL/RPR',
                'TPHA',
                'Widal',
                'Dengue NS1',
                'Dengue IgG/IgM',
                'Toxoplasma IgG/IgM',
                'Rubella IgG/IgM'
            ],
            'Imunologi': [
                'IgE Total',
                'IgG',
                'IgM',
                'IgA',
                'Komplemen C3',
                'Komplemen C4',
                'ANA Test',
                'RF (Rheumatoid Factor)',
                'CRP (C-Reactive Protein)'
            ]
        };

        // Material database berdasarkan kombinasi pemeriksaan dan sampel
        const materialDatabase = {
            'Hematologi': {
                'Darah Kapiler': {
                    'BMHP': [
                        { nama: 'Alcohol swab 70%', satuan: 'pcs', default: 2 },
                        { nama: 'Disposable lancet 28G', satuan: 'pcs', default: 1 },
                        { nama: 'Kapas steril', satuan: 'pcs', default: 2 },
                        { nama: 'Object glass', satuan: 'pcs', default: 2 },
                        { nama: 'Cover glass', satuan: 'pcs', default: 2 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Larutan Giemsa', satuan: 'ml', default: 2 },
                        { nama: 'Methanol', satuan: 'ml', default: 3 },
                        { nama: 'Buffer pH 7.2', satuan: 'ml', default: 5 }
                    ]
                },
                'Darah Vena': {
                    'BMHP': [
                        { nama: 'Alcohol swab 70%', satuan: 'pcs', default: 2 },
                        { nama: 'Spuit 3cc/5cc', satuan: 'pcs', default: 1 },
                        { nama: 'Vacutainer EDTA 3ml', satuan: 'pcs', default: 1 },
                        { nama: 'Plester hypoallergenic', satuan: 'pcs', default: 1 },
                        { nama: 'Kapas steril', satuan: 'pcs', default: 2 },
                        { nama: 'Tourniquet', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Hematology Control', satuan: 'ml', default: 0.05 },
                        { nama: 'Hematology Lyse', satuan: 'ml', default: 0.5 },
                        { nama: 'Hematology Clean', satuan: 'ml', default: 0.05 },
                        { nama: 'Hematology Diluent', satuan: 'ml', default: 36 }
                    ]
                }
            },
            'Kimia Darah': {
                'Darah Kapiler': {
                    'BMHP': [
                        { nama: 'Alcohol swab 70%', satuan: 'pcs', default: 2 },
                        { nama: 'Disposable lancet 28G', satuan: 'pcs', default: 1 },
                        { nama: 'Kapas steril', satuan: 'pcs', default: 2 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Strip glukosa', satuan: 'pcs', default: 1 },
                        { nama: 'Strip asam urat', satuan: 'pcs', default: 1 },
                        { nama: 'Strip kolesterol', satuan: 'pcs', default: 1 }
                    ]
                },
                'Darah Vena': {
                    'BMHP': [
                        { nama: 'Alcohol swab 70%', satuan: 'pcs', default: 2 },
                        { nama: 'Spuit 3cc/5cc', satuan: 'pcs', default: 1 },
                        { nama: 'Vacutainer clot activator 3ml', satuan: 'pcs', default: 1 },
                        { nama: 'Plester hypoallergenic', satuan: 'pcs', default: 1 },
                        { nama: 'Kapas steril', satuan: 'pcs', default: 2 },
                        { nama: 'Tourniquet', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Reagen glukosa GOD-PAP', satuan: 'ml', default: 1 },
                        { nama: 'Reagen kolesterol CHOD-PAP', satuan: 'ml', default: 1 },
                        { nama: 'Reagen trigliserida GPO-PAP', satuan: 'ml', default: 1 },
                        { nama: 'Reagen asam urat', satuan: 'ml', default: 1 },
                        { nama: 'Reagen ureum', satuan: 'ml', default: 1 },
                        { nama: 'Reagen kreatinin', satuan: 'ml', default: 1 },
                        { nama: 'Reagen SGOT/SGPT', satuan: 'ml', default: 1 }
                    ]
                }
            },
            'Urinalisis': {
                'Urine': {
                    'BMHP': [
                        { nama: 'Pot urine steril 50ml', satuan: 'pcs', default: 1 },
                        { nama: 'Label spesimen', satuan: 'pcs', default: 1 },
                        { nama: 'Tabung centrifuge 10ml', satuan: 'pcs', default: 1 },
                        { nama: 'Pipet tetes', satuan: 'pcs', default: 1 },
                        { nama: 'Object glass', satuan: 'pcs', default: 1 },
                        { nama: 'Cover glass', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Urine strip 10 parameter', satuan: 'pcs', default: 1 },
                        { nama: 'Larutan SSA 20%', satuan: 'ml', default: 2 },
                        { nama: 'Asam asetat 3%', satuan: 'ml', default: 2 }
                    ]
                }
            },
            'Mikrobiologi': {
                'Swab': {
                    'BMHP': [
                        { nama: 'Swab steril', satuan: 'pcs', default: 1 },
                        { nama: 'Media transport Stuart/Amies', satuan: 'pcs', default: 1 },
                        { nama: 'Label spesimen', satuan: 'pcs', default: 1 },
                        { nama: 'Cawan petri steril', satuan: 'pcs', default: 2 },
                        { nama: 'Ose bulat steril', satuan: 'pcs', default: 1 },
                        { nama: 'Object glass', satuan: 'pcs', default: 2 },
                        { nama: 'Sarung tangan steril', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Blood agar plate', satuan: 'pcs', default: 1 },
                        { nama: 'Mac Conkey agar', satuan: 'pcs', default: 1 },
                        { nama: 'Crystal violet (pewarna gram)', satuan: 'ml', default: 0.5 },
                        { nama: 'Lugol (pewarna gram)', satuan: 'ml', default: 0.5 },
                        { nama: 'Alkohol 95% (pewarna gram)', satuan: 'ml', default: 0.5 },
                        { nama: 'Safranin (pewarna gram)', satuan: 'ml', default: 0.5 },
                        { nama: 'Disk antibiotik (set)', satuan: 'set', default: 1 }
                    ]
                },
                'Dahak': {
                    'BMHP': [
                        { nama: 'Pot dahak steril 50ml', satuan: 'pcs', default: 1 },
                        { nama: 'Label spesimen', satuan: 'pcs', default: 1 },
                        { nama: 'Object glass', satuan: 'pcs', default: 3 },
                        { nama: 'Ose steril', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 },
                        { nama: 'Masker N95', satuan: 'pcs', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Ziehl-Neelsen carbol fuchsin', satuan: 'ml', default: 3 },
                        { nama: 'Asam alkohol 3%', satuan: 'ml', default: 2 },
                        { nama: 'Methylen blue', satuan: 'ml', default: 1 },
                        { nama: 'Lowenstein-Jensen medium', satuan: 'pcs', default: 2 }
                    ]
                },
                'Urine': {
                    'BMHP': [
                        { nama: 'Pot urine steril 50ml', satuan: 'pcs', default: 1 },
                        { nama: 'Label spesimen', satuan: 'pcs', default: 1 },
                        { nama: 'Cawan petri steril', satuan: 'pcs', default: 2 },
                        { nama: 'Ose kalibrasi 0.001ml', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan steril', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'CLED agar', satuan: 'pcs', default: 1 },
                        { nama: 'Mac Conkey agar', satuan: 'pcs', default: 1 },
                        { nama: 'Disk antibiotik (set)', satuan: 'set', default: 1 }
                    ]
                },
                'Darah Vena': {
                    'BMHP': [
                        { nama: 'Alcohol swab 70%', satuan: 'pcs', default: 3 },
                        { nama: 'Spuit 10cc steril', satuan: 'pcs', default: 1 },
                        { nama: 'Botol kultur darah aerob', satuan: 'pcs', default: 1 },
                        { nama: 'Botol kultur darah anaerob', satuan: 'pcs', default: 1 },
                        { nama: 'Plester hypoallergenic', satuan: 'pcs', default: 1 },
                        { nama: 'Kapas steril', satuan: 'pcs', default: 2 },
                        { nama: 'Tourniquet', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan steril', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Media kultur otomatis', satuan: 'ml', default: 40 },
                        { nama: 'Blood agar plate', satuan: 'pcs', default: 1 },
                        { nama: 'Chocolate agar', satuan: 'pcs', default: 1 },
                        { nama: 'Disk antibiotik (set)', satuan: 'set', default: 1 }
                    ]
                }
            },
            'Serologi': {
                'Darah Vena': {
                    'BMHP': [
                        { nama: 'Alcohol swab 70%', satuan: 'pcs', default: 2 },
                        { nama: 'Spuit 3cc/5cc', satuan: 'pcs', default: 1 },
                        { nama: 'Vacutainer clot activator 3ml', satuan: 'pcs', default: 1 },
                        { nama: 'Plester hypoallergenic', satuan: 'pcs', default: 1 },
                        { nama: 'Kapas steril', satuan: 'pcs', default: 2 },
                        { nama: 'Tourniquet', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'Rapid test HIV', satuan: 'pcs', default: 1 },
                        { nama: 'Rapid test HBsAg', satuan: 'pcs', default: 1 },
                        { nama: 'Rapid test Anti HCV', satuan: 'pcs', default: 1 },
                        { nama: 'Rapid test dengue NS1/IgG/IgM', satuan: 'pcs', default: 1 },
                        { nama: 'VDRL antigen', satuan: 'test', default: 1 },
                        { nama: 'Buffer/diluent', satuan: 'ml', default: 2 }
                    ]
                }
            },
            'Imunologi': {
                'Darah Vena': {
                    'BMHP': [
                        { nama: 'Alcohol swab 70%', satuan: 'pcs', default: 2 },
                        { nama: 'Spuit 3cc/5cc', satuan: 'pcs', default: 1 },
                        { nama: 'Vacutainer clot activator 3ml', satuan: 'pcs', default: 1 },
                        { nama: 'Plester hypoallergenic', satuan: 'pcs', default: 1 },
                        { nama: 'Kapas steril', satuan: 'pcs', default: 2 },
                        { nama: 'Tourniquet', satuan: 'pcs', default: 1 },
                        { nama: 'Sarung tangan pemeriksaan', satuan: 'pasang', default: 1 }
                    ],
                    'Reagen': [
                        { nama: 'IgE test kit', satuan: 'test', default: 1 },
                        { nama: 'Complement C3/C4 kit', satuan: 'test', default: 1 },
                        { nama: 'ANA test kit', satuan: 'test', default: 1 },
                        { nama: 'Buffer/diluent', satuan: 'ml', default: 2 }
                    ]
                }
            }
        };

        let currentNIKData = null;
        let selectedParameters = [];
        let selectedType = null;
        let customMaterials = { BMHP: [], Reagen: [] };
        let currentAddCategory = '';
        let customMaterialCounter = 0;

        // Storage for pengeluaran data (simulates database)
        let pengeluaranData = [];

        // Multi-select parameter functions
        function toggleParameterDropdown() {
            const dropdown = document.getElementById('parameterDropdown');
            dropdown.classList.toggle('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const multiSelect = document.querySelector('.multi-select-wrapper');
            const dropdown = document.getElementById('parameterDropdown');
            
            if (multiSelect && !multiSelect.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        // Update parameter options based on pemeriksaan
        function updateParameterOptions() {
            const pemeriksaan = document.getElementById('pemeriksaanSelect').value;
            const dropdown = document.getElementById('parameterDropdown');
            
            dropdown.innerHTML = '';
            
            if (pemeriksaan && parameterDatabase[pemeriksaan]) {
                parameterDatabase[pemeriksaan].forEach((param, index) => {
                    const option = document.createElement('div');
                    option.className = 'multi-select-option';
                    option.innerHTML = `
                        <input type="checkbox" class="multi-select-checkbox" value="${param}" id="param${index}" onchange="updateParameterDisplay()">
                        <label for="param${index}">${param}</label>
                    `;
                    dropdown.appendChild(option);
                });
            }
            
            // Reset selection
            selectedParameters = [];
            document.getElementById('parameterPlaceholder').style.display = 'block';
            document.getElementById('parameterValues').style.display = 'none';
            document.getElementById('parameterHidden').value = '';
        }

        function updateParameterDisplay() {
            const checkboxes = document.querySelectorAll('.multi-select-checkbox');
            selectedParameters = [];
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selectedParameters.push(checkbox.value);
                }
            });
            
            const placeholder = document.getElementById('parameterPlaceholder');
            const values = document.getElementById('parameterValues');
            const hidden = document.getElementById('parameterHidden');
            
            if (selectedParameters.length > 0) {
                placeholder.style.display = 'none';
                values.style.display = 'block';
                values.textContent = selectedParameters.join(', ');
                hidden.value = selectedParameters.join('; ');
            } else {
                placeholder.style.display = 'block';
                values.style.display = 'none';
                hidden.value = '';
            }
        }

        // Type selection
        function selectType(type) {
            selectedType = type;
            
            document.getElementById('typeSampel').checked = (type === 'sampel');
            document.getElementById('typeControl').checked = (type === 'control');
            document.getElementById('typeAlat').checked = (type === 'alat');
            
            document.querySelectorAll('.type-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }

        // Parse NIK berdasarkan aturan Indonesia
        function parseNIK(nik) {
            if (nik.length !== 16 || !/^\d+$/.test(nik)) {
                return null;
            }

            const provinceCode = nik.substring(0, 2);
            const cityCode = nik.substring(2, 4);
            const birthDateCode = nik.substring(6, 12);
            
            let day = parseInt(birthDateCode.substring(0, 2));
            const month = parseInt(birthDateCode.substring(2, 4));
            const year = parseInt(birthDateCode.substring(4, 6));
            
            let gender = 'Laki-laki';
            if (day > 40) {
                gender = 'Perempuan';
                day -= 40;
            }
            
            if (day < 1 || day > 31 || month < 1 || month > 12) {
                return null;
            }
            
            const fullYear = year <= 24 ? 2000 + year : 1900 + year;
            const today = new Date();
            const birthDate = new Date(fullYear, month - 1, day);
            
            if (birthDate > today) {
                return null;
            }
            
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            const province = wilayahData[provinceCode];
            if (!province) return null;
            
            const city = province.cities[cityCode];
            if (!city) return null;
            
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
            
            return {
                nik: nik,
                gender: gender,
                birthDate: `${String(day).padStart(2, '0')} ${monthNames[month - 1]} ${fullYear}`,
                age: `${age} tahun`,
                province: province.name,
                city: city.name,
                kecamatanList: city.kecamatan
            };
        }

        // NIK input listener
        document.addEventListener('DOMContentLoaded', function() {
            const nikInput = document.getElementById('nikInput');
            if (nikInput) {
                nikInput.addEventListener('input', function() {
                    const nik = this.value.trim();
                    const patientInfoBox = document.getElementById('patientInfoBox');
                    const nikError = document.getElementById('nikError');
                    
                    if (nik.length === 16) {
                        const data = parseNIK(nik);
                        
                        if (data) {
                            currentNIKData = data;
                            
                            document.getElementById('patientGender').textContent = data.gender;
                            document.getElementById('patientBirthDate').textContent = data.birthDate;
                            document.getElementById('patientAge').textContent = data.age;
                            document.getElementById('patientProvince').textContent = data.province;
                            document.getElementById('patientCity').textContent = data.city;
                            
                            const kecamatanSelect = document.getElementById('kecamatanSelect');
                            kecamatanSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';
                            data.kecamatanList.forEach(kec => {
                                const option = document.createElement('option');
                                option.value = kec;
                                option.textContent = kec;
                                kecamatanSelect.appendChild(option);
                            });
                            
                            patientInfoBox.style.display = 'block';
                            nikError.style.display = 'none';
                        } else {
                            patientInfoBox.style.display = 'none';
                            nikError.style.display = 'block';
                            currentNIKData = null;
                        }
                    } else {
                        patientInfoBox.style.display = 'none';
                        nikError.style.display = 'none';
                    }
                });
            }
        });

        function goBack() {
            const form = document.getElementById('labDistributionForm');
            const menu = document.getElementById('inventoryMenu');
            const riwayat = document.getElementById('riwayatPengeluaranSection');
            const title = document.getElementById('pageTitle');
            const step0 = document.getElementById('step0Section');
            const step1 = document.getElementById('step1Section');
            const step2 = document.getElementById('step2Section');
            const step3 = document.getElementById('step3Section');
            
            if (step3.style.display === 'block') {
                backFromStep3();
            } else if (step2.style.display === 'block') {
                backFromStep2();
            } else if (step1.style.display === 'block') {
                step1.style.display = 'none';
                step0.style.display = 'block';
                window.scrollTo(0, 0);
            } else if (form.style.display === 'block') {
                form.style.display = 'none';
                menu.style.display = 'block';
                title.textContent = 'Inventaris';
                resetForm();
            } else if (riwayat.style.display === 'block') {
                riwayat.style.display = 'none';
                menu.style.display = 'block';
                title.textContent = 'Inventaris';
            }
        }

        function resetForm() {
            document.getElementById('step1Form').reset();
            document.getElementById('step2Form').reset();
            document.getElementById('patientInfoBox').style.display = 'none';
            document.getElementById('nikError').style.display = 'none';
            
            const checkboxes = document.querySelectorAll('.multi-select-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = false);
            selectedParameters = [];
            document.getElementById('parameterPlaceholder').style.display = 'block';
            document.getElementById('parameterValues').style.display = 'none';
            document.getElementById('parameterHidden').value = '';
            
            currentNIKData = null;
            selectedType = null;
            customMaterials = { BMHP: [], Reagen: [] };
            customMaterialCounter = 0;
            
            document.querySelectorAll('.type-card').forEach(card => card.classList.remove('selected'));
            document.querySelectorAll('input[name="tipeOutput"]').forEach(radio => radio.checked = false);
            
            document.getElementById('step0Section').style.display = 'block';
            document.getElementById('step1Section').style.display = 'none';
            document.getElementById('step2Section').style.display = 'none';
            document.getElementById('step3Section').style.display = 'none';
        }

        function showPage(page) {
            const form = document.getElementById('labDistributionForm');
            const menu = document.getElementById('inventoryMenu');
            const riwayat = document.getElementById('riwayatPengeluaranSection');
            const title = document.getElementById('pageTitle');

            // Hide all pages first
            form.style.display = 'none';
            menu.style.display = 'none';
            riwayat.style.display = 'none';

            if (page === 'labDistribution') {
                form.style.display = 'block';
                title.textContent = 'Pengeluaran Lab';
            } else if (page === 'riwayatPengeluaran') {
                riwayat.style.display = 'block';
                title.textContent = 'Riwayat Pengeluaran Lab';
                renderHistory();
            }
        }

        function goToStep1() {
            if (!selectedType) {
                alert('Silakan pilih tipe pengeluaran');
                return;
            }

            if (selectedType === 'sampel') {
                document.getElementById('step0Section').style.display = 'none';
                document.getElementById('step1Section').style.display = 'block';
            } else {
                // Langsung ke step 2 untuk Control dan Alat
                document.getElementById('step0Section').style.display = 'none';
                document.getElementById('step2Section').style.display = 'block';
                updateStep2Indicator();
            }
            window.scrollTo(0, 0);
        }

        function updateStep2Indicator() {
            const indicator = document.getElementById('step2Indicator');
            if (selectedType === 'sampel') {
                indicator.innerHTML = `
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Tipe</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Data Pasien</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item active">
                        <div class="step-number">3</div>
                        <div class="step-label">Pemeriksaan</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-label">Material</div>
                    </div>
                `;
            } else {
                indicator.innerHTML = `
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Tipe</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item active">
                        <div class="step-number">2</div>
                        <div class="step-label">Pemeriksaan</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-label">Material</div>
                    </div>
                `;
            }
        }

        function updateStep3Indicator() {
            const indicator = document.getElementById('step3Indicator');
            if (selectedType === 'sampel') {
                indicator.innerHTML = `
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Tipe</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Data Pasien</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Pemeriksaan</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item active">
                        <div class="step-number">4</div>
                        <div class="step-label">Material</div>
                    </div>
                `;
            } else {
                indicator.innerHTML = `
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Tipe</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item completed">
                        <div class="step-number">‚úì</div>
                        <div class="step-label">Pemeriksaan</div>
                        <div class="step-line"></div>
                    </div>
                    <div class="step-item active">
                        <div class="step-number">3</div>
                        <div class="step-label">Material</div>
                    </div>
                `;
            }
        }

        function goToStep2() {
            if (!currentNIKData) {
                alert('Data NIK tidak valid');
                return;
            }
            
            const nama = document.getElementById('namaInput').value.trim();
            const kecamatan = document.getElementById('kecamatanSelect').value;
            const alamat = document.getElementById('alamatInput').value.trim();
            const telepon = document.getElementById('teleponInput').value.trim();
            
            if (!nama) {
                alert('Silakan isi nama lengkap');
                return;
            }
            
            if (!kecamatan) {
                alert('Silakan pilih kecamatan');
                return;
            }
            
            if (!alamat) {
                alert('Silakan isi alamat lengkap');
                return;
            }
            
            if (!telepon) {
                alert('Silakan isi nomor telepon');
                return;
            }
            
            if (!/^[0-9]{10,13}$/.test(telepon)) {
                alert('Nomor telepon harus 10-13 digit angka');
                return;
            }
            
            document.getElementById('step1Section').style.display = 'none';
            document.getElementById('step2Section').style.display = 'block';
            updateStep2Indicator();
            window.scrollTo(0, 0);
        }

        function backFromStep2() {
            if (selectedType === 'sampel') {
                document.getElementById('step2Section').style.display = 'none';
                document.getElementById('step1Section').style.display = 'block';
            } else {
                document.getElementById('step2Section').style.display = 'none';
                document.getElementById('step0Section').style.display = 'block';
            }
            window.scrollTo(0, 0);
        }

        function backFromStep3() {
            document.getElementById('step3Section').style.display = 'none';
            document.getElementById('step2Section').style.display = 'block';
            window.scrollTo(0, 0);
        }

        function goToStep3() {
            if (selectedParameters.length === 0) {
                alert('Silakan pilih minimal 1 parameter');
                return;
            }

            const pemeriksaan = document.getElementById('pemeriksaanSelect').value;
            const sampel = document.getElementById('sampelSelect').value;

            if (!pemeriksaan || !sampel) {
                alert('Silakan lengkapi semua field');
                return;
            }

            // Generate material list
            generateMaterialList(pemeriksaan, sampel);

            document.getElementById('step2Section').style.display = 'none';
            document.getElementById('step3Section').style.display = 'block';
            updateStep3Indicator();
            window.scrollTo(0, 0);
        }

        function generateMaterialList(pemeriksaan, sampel) {
            const container = document.getElementById('materialListContainer');
            container.innerHTML = '';

            // Get materials based on pemeriksaan and sampel
            const pemeriksaanData = materialDatabase[pemeriksaan];
            if (!pemeriksaanData) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Data material tidak tersedia untuk pemeriksaan ini.</p>';
                return;
            }

            const materials = pemeriksaanData[sampel] || pemeriksaanData[Object.keys(pemeriksaanData)[0]];

            // Generate BMHP category
            if (materials.BMHP && materials.BMHP.length > 0) {
                const bmhpCategory = document.createElement('div');
                bmhpCategory.className = 'material-category';
                bmhpCategory.innerHTML = `
                    <div class="category-header">BMHP</div>
                    <div class="material-items" id="bmhpItems"></div>
                    <button type="button" class="add-material-btn" onclick="openAddMaterialModal('BMHP')">
                        + Tambah BMHP Lainnya
                    </button>
                `;
                container.appendChild(bmhpCategory);

                const bmhpContainer = bmhpCategory.querySelector('#bmhpItems');
                materials.BMHP.forEach((item, index) => {
                    const itemDiv = createMaterialItem(item, 'bmhp', index, false);
                    bmhpContainer.appendChild(itemDiv);
                });

                // Add custom BMHP materials
                customMaterials.BMHP.forEach((item, index) => {
                    const itemDiv = createMaterialItem(item, 'bmhp-custom', index, true);
                    bmhpContainer.appendChild(itemDiv);
                });
            }

            // Generate Reagen category
            if (materials.Reagen && materials.Reagen.length > 0) {
                const reagenCategory = document.createElement('div');
                reagenCategory.className = 'material-category';
                reagenCategory.innerHTML = `
                    <div class="category-header">Reagen</div>
                    <div class="material-items" id="reagenItems"></div>
                    <button type="button" class="add-material-btn" onclick="openAddMaterialModal('Reagen')">
                        + Tambah Reagen Lainnya
                    </button>
                `;
                container.appendChild(reagenCategory);

                const reagenContainer = reagenCategory.querySelector('#reagenItems');
                materials.Reagen.forEach((item, index) => {
                    const itemDiv = createMaterialItem(item, 'reagen', index, false);
                    reagenContainer.appendChild(itemDiv);
                });

                // Add custom Reagen materials
                customMaterials.Reagen.forEach((item, index) => {
                    const itemDiv = createMaterialItem(item, 'reagen-custom', index, true);
                    reagenContainer.appendChild(itemDiv);
                });
            }
        }

        function createMaterialItem(item, prefix, index, isCustom) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'material-item';
            const itemId = `${prefix}-${index}`;
            itemDiv.setAttribute('data-material-id', itemId);
            
            itemDiv.innerHTML = `
                ${isCustom ? `<button type="button" class="delete-material-btn" onclick="deleteCustomMaterial('${prefix}', ${index})">√ó</button>` : ''}
                <div class="material-name">${item.nama}</div>
                <div class="material-details">
                    <span class="material-unit">${item.satuan}</span>
                    <div class="quantity-control">
                        <span class="quantity-label">Jumlah:</span>
                        <div class="quantity-input-group">
                            <button type="button" class="qty-btn" onclick="decrementQty('${itemId}')">‚àí</button>
                            <input type="number" class="quantity-input" id="${itemId}" value="${item.default || 0}" min="0" step="0.01">
                            <button type="button" class="qty-btn" onclick="incrementQty('${itemId}')">+</button>
                        </div>
                    </div>
                </div>
            `;
            
            return itemDiv;
        }

        function incrementQty(id) {
            const input = document.getElementById(id);
            const step = parseFloat(input.step) || 1;
            input.value = (parseFloat(input.value) || 0) + step;
        }

        function decrementQty(id) {
            const input = document.getElementById(id);
            const step = parseFloat(input.step) || 1;
            const newValue = (parseFloat(input.value) || 0) - step;
            input.value = Math.max(0, newValue);
        }

        // Modal functions
        function openAddMaterialModal(category) {
            currentAddCategory = category;
            document.getElementById('addMaterialModal').classList.add('active');
            document.getElementById('newMaterialCategory').value = category;
            document.getElementById('newMaterialName').value = '';
            document.getElementById('newMaterialName').disabled = false;
            document.getElementById('newMaterialUnit').value = '';
            document.getElementById('newMaterialQty').value = '';
            
            // Populate material dropdown based on category
            updateMaterialOptions();
        }

        function updateMaterialOptions() {
            const category = document.getElementById('newMaterialCategory').value;
            const materialSelect = document.getElementById('newMaterialName');
            const unitInput = document.getElementById('newMaterialUnit');
            
            // Reset
            materialSelect.innerHTML = '<option value="">Pilih nama material</option>';
            unitInput.value = '';
            
            if (category && masterMaterialDatabase[category]) {
                materialSelect.disabled = false;
                
                // Get existing materials in the list to filter them out
                const existingMaterials = new Set();
                const pemeriksaan = document.getElementById('pemeriksaanSelect').value;
                const sampel = document.getElementById('sampelSelect').value;
                const pemeriksaanData = materialDatabase[pemeriksaan];
                
                if (pemeriksaanData) {
                    const materials = pemeriksaanData[sampel] || pemeriksaanData[Object.keys(pemeriksaanData)[0]];
                    if (materials && materials[category]) {
                        materials[category].forEach(item => existingMaterials.add(item.nama));
                    }
                }
                
                // Also add custom materials to the set
                customMaterials[category].forEach(item => existingMaterials.add(item.nama));
                
                // Populate dropdown with materials not yet in the list
                let availableCount = 0;
                masterMaterialDatabase[category].forEach(material => {
                    if (!existingMaterials.has(material.nama)) {
                        const option = document.createElement('option');
                        option.value = material.nama;
                        option.textContent = material.nama;
                        option.setAttribute('data-unit', material.satuan);
                        materialSelect.appendChild(option);
                        availableCount++;
                    }
                });
                
                // If no materials available
                if (availableCount === 0) {
                    materialSelect.disabled = true;
                    materialSelect.innerHTML = '<option value="">Semua material sudah ditambahkan</option>';
                }
            } else {
                materialSelect.disabled = true;
                materialSelect.innerHTML = '<option value="">Pilih kategori terlebih dahulu</option>';
            }
        }

        function updateMaterialUnit() {
            const materialSelect = document.getElementById('newMaterialName');
            const unitInput = document.getElementById('newMaterialUnit');
            
            if (materialSelect.value) {
                const selectedOption = materialSelect.options[materialSelect.selectedIndex];
                const unit = selectedOption.getAttribute('data-unit');
                unitInput.value = unit || '';
            } else {
                unitInput.value = '';
            }
        }

        function closeAddMaterialModal() {
            document.getElementById('addMaterialModal').classList.remove('active');
            currentAddCategory = '';
        }

        function addNewMaterial() {
            const category = document.getElementById('newMaterialCategory').value;
            const nama = document.getElementById('newMaterialName').value;
            const satuan = document.getElementById('newMaterialUnit').value;
            const qty = parseFloat(document.getElementById('newMaterialQty').value);

            if (!category) {
                alert('Silakan pilih kategori');
                return;
            }

            if (!nama) {
                alert('Silakan pilih nama material');
                return;
            }

            if (!satuan) {
                alert('Satuan tidak tersedia');
                return;
            }

            if (isNaN(qty) || qty <= 0) {
                alert('Silakan isi jumlah dengan benar (harus lebih dari 0)');
                return;
            }

            const newMaterial = {
                nama: nama,
                satuan: satuan,
                default: qty
            };

            customMaterials[category].push(newMaterial);
            closeAddMaterialModal();

            // Refresh material list
            const pemeriksaan = document.getElementById('pemeriksaanSelect').value;
            const sampel = document.getElementById('sampelSelect').value;
            generateMaterialList(pemeriksaan, sampel);
        }

        function deleteCustomMaterial(prefix, index) {
            if (confirm('Hapus material ini?')) {
                const category = prefix.includes('bmhp') ? 'BMHP' : 'Reagen';
                customMaterials[category].splice(index, 1);
                
                // Refresh material list
                const pemeriksaan = document.getElementById('pemeriksaanSelect').value;
                const sampel = document.getElementById('sampelSelect').value;
                generateMaterialList(pemeriksaan, sampel);
            }
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        function confirmSubmit() {
            closeConfirmModal();
            
            // Collect materials
            const materials = collectMaterials();

            // Prepare data object
            const dataEntry = {
                id: Date.now(),
                timestamp: new Date(),
                type: selectedType,
                pemeriksaan: document.getElementById('pemeriksaanSelect').value,
                parameter: [...selectedParameters],
                sampel: document.getElementById('sampelSelect').value,
                materials: {
                    BMHP: [...materials.BMHP],
                    Reagen: [...materials.Reagen]
                }
            };

            // Add patient data if type is sampel
            if (selectedType === 'sampel' && currentNIKData) {
                dataEntry.pasien = {
                    nik: currentNIKData.nik,
                    nama: document.getElementById('namaInput').value,
                    gender: currentNIKData.gender,
                    birthDate: currentNIKData.birthDate,
                    age: currentNIKData.age,
                    province: currentNIKData.province,
                    city: currentNIKData.city,
                    kecamatan: document.getElementById('kecamatanSelect').value,
                    alamat: document.getElementById('alamatInput').value,
                    telepon: document.getElementById('teleponInput').value
                };
            }

            // Save to array
            pengeluaranData.unshift(dataEntry); // Add to beginning of array
            
            // Create final summary
            let summary = '‚úì DATA PENGELUARAN LAB BERHASIL DISIMPAN!\n\n';
            summary += `=== TIPE PENGELUARAN ===\n${selectedType.toUpperCase()}\n\n`;

            if (selectedType === 'sampel' && currentNIKData) {
                const nama = document.getElementById('namaInput').value;
                const kecamatan = document.getElementById('kecamatanSelect').value;
                const alamat = document.getElementById('alamatInput').value;
                const telepon = document.getElementById('teleponInput').value;

                summary += `=== DATA PASIEN ===\n`;
                summary += `NIK: ${currentNIKData.nik}\n`;
                summary += `Nama: ${nama}\n`;
                summary += `Jenis Kelamin: ${currentNIKData.gender}\n`;
                summary += `Tanggal Lahir: ${currentNIKData.birthDate}\n`;
                summary += `Usia: ${currentNIKData.age}\n`;
                summary += `Provinsi: ${currentNIKData.province}\n`;
                summary += `Kab/Kota: ${currentNIKData.city}\n`;
                summary += `Kecamatan: ${kecamatan}\n`;
                summary += `Alamat: ${alamat}\n`;
                summary += `Telepon: ${telepon}\n\n`;
            }

            const pemeriksaan = document.getElementById('pemeriksaanSelect').value;
            const sampel = document.getElementById('sampelSelect').value;

            summary += `=== DATA PEMERIKSAAN ===\n`;
            summary += `Pemeriksaan: ${pemeriksaan}\n`;
            summary += `Parameter:\n${selectedParameters.map((p, i) => `  ${i + 1}. ${p}`).join('\n')}\n`;
            summary += `Sampel: ${sampel}\n\n`;

            summary += `=== MATERIAL BMHP ===\n`;
            summary += materials.BMHP.length > 0 ? materials.BMHP.map((m, i) => `${i + 1}. ${m}`).join('\n') : 'Tidak ada';
            
            summary += `\n\n=== MATERIAL REAGEN ===\n`;
            summary += materials.Reagen.length > 0 ? materials.Reagen.map((m, i) => `${i + 1}. ${m}`).join('\n') : 'Tidak ada';

            alert(summary);
            
            // Reset to main menu
            const form = document.getElementById('labDistributionForm');
            const menu = document.getElementById('inventoryMenu');
            const title = document.getElementById('pageTitle');
            
            form.style.display = 'none';
            menu.style.display = 'block';
            title.textContent = 'Inventaris';
            resetForm();
        }

        function collectMaterials() {
            const materials = {
                BMHP: [],
                Reagen: []
            };
            
            const bmhpInputs = document.querySelectorAll('[id^="bmhp-"]');
            bmhpInputs.forEach((input) => {
                const qty = parseFloat(input.value);
                if (qty > 0) {
                    const item = input.closest('.material-item');
                    const nama = item.querySelector('.material-name').textContent;
                    const satuan = item.querySelector('.material-unit').textContent;
                    materials.BMHP.push(`${nama}: ${qty} ${satuan}`);
                }
            });

            const reagenInputs = document.querySelectorAll('[id^="reagen-"]');
            reagenInputs.forEach((input) => {
                const qty = parseFloat(input.value);
                if (qty > 0) {
                    const item = input.closest('.material-item');
                    const nama = item.querySelector('.material-name').textContent;
                    const satuan = item.querySelector('.material-unit').textContent;
                    materials.Reagen.push(`${nama}: ${qty} ${satuan}`);
                }
            });

            return materials;
        }

        function handleSubmit() {
            // Collect materials
            const materials = collectMaterials();

            // Validate at least one material
            if (materials.BMHP.length === 0 && materials.Reagen.length === 0) {
                alert('Silakan isi jumlah minimal 1 material');
                return;
            }

            // Show confirmation modal
            let modalContent = '<div class="summary-section">';
            modalContent += '<div class="summary-title">TIPE PENGELUARAN</div>';
            modalContent += `<div class="summary-text"><span class="summary-highlight">${selectedType.toUpperCase()}</span></div>`;
            modalContent += '</div>';

            if (selectedType === 'sampel' && currentNIKData) {
                const nama = document.getElementById('namaInput').value;
                modalContent += '<div class="summary-section">';
                modalContent += '<div class="summary-title">DATA PASIEN</div>';
                modalContent += `<div class="summary-text">`;
                modalContent += `<span class="summary-highlight">${nama}</span><br>`;
                modalContent += `NIK: ${currentNIKData.nik}<br>`;
                modalContent += `${currentNIKData.gender}, ${currentNIKData.age}`;
                modalContent += `</div></div>`;
            }

            const pemeriksaan = document.getElementById('pemeriksaanSelect').value;
            const sampel = document.getElementById('sampelSelect').value;

            modalContent += '<div class="summary-section">';
            modalContent += '<div class="summary-title">PEMERIKSAAN</div>';
            modalContent += `<div class="summary-text">`;
            modalContent += `<span class="summary-highlight">${pemeriksaan}</span><br>`;
            modalContent += `Sampel: ${sampel}<br>`;
            modalContent += `Parameter: ${selectedParameters.length} item`;
            modalContent += `</div></div>`;

            modalContent += '<div class="summary-section">';
            modalContent += '<div class="summary-title">MATERIAL</div>';
            modalContent += `<div class="summary-text">`;
            modalContent += `BMHP: ${materials.BMHP.length} item<br>`;
            modalContent += `Reagen: ${materials.Reagen.length} item`;
            modalContent += `</div></div>`;

            modalContent += '<p style="color: #666; font-size: 13px; margin-top: 15px;">Apakah Anda yakin ingin menyimpan data ini?</p>';

            document.getElementById('confirmModalBody').innerHTML = modalContent;
            document.getElementById('confirmModal').classList.add('active');
        }

        // ====== HISTORY PAGE FUNCTIONS ======

        function renderHistory() {
            const container = document.getElementById('historyCardsContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterType = document.getElementById('filterType').value;
            const filterDate = document.getElementById('filterDate').value;

            // Filter data
            let filteredData = pengeluaranData.filter(item => {
                // Search filter
                let matchSearch = true;
                if (searchTerm) {
                    matchSearch = false;
                    if (item.pasien) {
                        if (item.pasien.nik.toLowerCase().includes(searchTerm) ||
                            item.pasien.nama.toLowerCase().includes(searchTerm)) {
                            matchSearch = true;
                        }
                    }
                }

                // Type filter
                let matchType = true;
                if (filterType && item.type !== filterType) {
                    matchType = false;
                }

                // Date filter
                let matchDate = true;
                if (filterDate) {
                    const itemDate = new Date(item.timestamp);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    if (filterDate === 'today') {
                        const todayEnd = new Date(today);
                        todayEnd.setHours(23, 59, 59, 999);
                        matchDate = itemDate >= today && itemDate <= todayEnd;
                    } else if (filterDate === 'yesterday') {
                        const yesterday = new Date(today);
                        yesterday.setDate(yesterday.getDate() - 1);
                        const yesterdayEnd = new Date(yesterday);
                        yesterdayEnd.setHours(23, 59, 59, 999);
                        matchDate = itemDate >= yesterday && itemDate <= yesterdayEnd;
                    } else if (filterDate === '7days') {
                        const sevenDaysAgo = new Date(today);
                        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                        matchDate = itemDate >= sevenDaysAgo;
                    } else if (filterDate === '30days') {
                        const thirtyDaysAgo = new Date(today);
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        matchDate = itemDate >= thirtyDaysAgo;
                    }
                }

                return matchSearch && matchType && matchDate;
            });

            // Render cards
            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div class="empty-state-text">Tidak ada data pengeluaran</div>
                        <div class="empty-state-subtext">Data yang Anda cari tidak ditemukan</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            filteredData.forEach(item => {
                const card = createHistoryCard(item);
                container.appendChild(card);
            });
        }

        function createHistoryCard(item) {
            const card = document.createElement('div');
            card.className = 'history-card';
            card.onclick = () => showDetail(item.id);

            // Format date
            const date = new Date(item.timestamp);
            const dateStr = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
            const timeStr = date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            // Badge
            let badgeClass = 'badge-sampel';
            let badgeIcon = 'üìã';
            if (item.type === 'control') {
                badgeClass = 'badge-control';
                badgeIcon = 'üîß';
            } else if (item.type === 'alat') {
                badgeClass = 'badge-alat';
                badgeIcon = '‚öôÔ∏è';
            }

            // Card content
            let cardHTML = `
                <div class="card-header">
                    <div class="card-title-section">
                        <div class="card-type-badge ${badgeClass}">
                            ${badgeIcon} ${item.type.toUpperCase()}
                        </div>
                        <div class="card-datetime">${dateStr}, ${timeStr}</div>
                    </div>
                </div>
                <div class="card-divider"></div>
            `;

            // Patient info for sampel
            if (item.type === 'sampel' && item.pasien) {
                cardHTML += `
                    <div class="card-info-row">
                        <span class="card-label">NIK</span>
                        <span class="card-value">${item.pasien.nik}</span>
                    </div>
                    <div class="card-info-row">
                        <span class="card-label">Nama</span>
                        <span class="card-value">${item.pasien.nama}</span>
                    </div>
                `;
            }

            // Lab info - Show parameter values, not count
            const parameterDisplay = item.parameter.length > 2 
                ? item.parameter.slice(0, 2).join(', ') + `, +${item.parameter.length - 2} lainnya`
                : item.parameter.join(', ');

            cardHTML += `
                <div class="card-info-row">
                    <span class="card-label">Pemeriksaan</span>
                    <span class="card-value">${item.pemeriksaan}</span>
                </div>
                <div class="card-info-row">
                    <span class="card-label">Sampel</span>
                    <span class="card-value">${item.sampel}</span>
                </div>
                <div class="card-info-row">
                    <span class="card-label">Parameter</span>
                    <span class="card-value">${parameterDisplay}</span>
                </div>
                <div class="card-info-row">
                    <span class="card-label">Material</span>
                    <span class="card-value">${item.materials.BMHP.length + item.materials.Reagen.length} item</span>
                </div>
                <div class="card-footer">
                    <button class="view-detail-btn">
                        Lihat Detail ‚Üí
                    </button>
                </div>
            `;

            card.innerHTML = cardHTML;
            return card;
        }

        function filterHistory() {
            renderHistory();
        }

        function showDetail(id) {
            const item = pengeluaranData.find(d => d.id === id);
            if (!item) return;

            const modal = document.getElementById('detailModal');
            const modalBody = document.getElementById('detailModalBody');

            // Format date
            const date = new Date(item.timestamp);
            const dateStr = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
            const timeStr = date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });

            // Badge
            let badgeClass = 'badge-sampel';
            let badgeIcon = 'üìã';
            if (item.type === 'control') {
                badgeClass = 'badge-control';
                badgeIcon = 'üîß';
            } else if (item.type === 'alat') {
                badgeClass = 'badge-alat';
                badgeIcon = '‚öôÔ∏è';
            }

            let detailHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="badge-type-large ${badgeClass}">
                        ${badgeIcon} ${item.type.toUpperCase()}
                    </div>
                    <div style="font-size: 14px; color: #666;">${dateStr}, ${timeStr} WIB</div>
                </div>
            `;

            // Patient data
            if (item.type === 'sampel' && item.pasien) {
                detailHTML += `
                    <div class="detail-section">
                        <div class="detail-section-title">DATA PASIEN</div>
                        <div class="detail-row">
                            <div class="detail-label">NIK</div>
                            <div class="detail-value">${item.pasien.nik}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Nama</div>
                            <div class="detail-value">${item.pasien.nama}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Jenis Kelamin</div>
                            <div class="detail-value">${item.pasien.gender}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Tanggal Lahir</div>
                            <div class="detail-value">${item.pasien.birthDate}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Usia</div>
                            <div class="detail-value">${item.pasien.age}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Provinsi</div>
                            <div class="detail-value">${item.pasien.province}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Kab/Kota</div>
                            <div class="detail-value">${item.pasien.city}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Kecamatan</div>
                            <div class="detail-value">${item.pasien.kecamatan}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Alamat</div>
                            <div class="detail-value">${item.pasien.alamat}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Telepon</div>
                            <div class="detail-value">${item.pasien.telepon}</div>
                        </div>
                    </div>
                `;
            }

            // Lab data
            detailHTML += `
                <div class="detail-section">
                    <div class="detail-section-title">DATA PEMERIKSAAN</div>
                    <div class="detail-row">
                        <div class="detail-label">Pemeriksaan</div>
                        <div class="detail-value">${item.pemeriksaan}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Sampel</div>
                        <div class="detail-value">${item.sampel}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Parameter</div>
                        <div class="detail-value">
                            <ul class="detail-list">
                                ${item.parameter.map(p => `<li>${p}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            // Material BMHP
            if (item.materials.BMHP.length > 0) {
                detailHTML += `
                    <div class="detail-section">
                        <div class="detail-section-title">MATERIAL BMHP (${item.materials.BMHP.length} item)</div>
                        <ul class="detail-list">
                            ${item.materials.BMHP.map(m => `<li>${m}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            // Material Reagen
            if (item.materials.Reagen.length > 0) {
                detailHTML += `
                    <div class="detail-section">
                        <div class="detail-section-title">MATERIAL REAGEN (${item.materials.Reagen.length} item)</div>
                        <ul class="detail-list">
                            ${item.materials.Reagen.map(m => `<li>${m}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            modalBody.innerHTML = detailHTML;
            modal.classList.add('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        // Add some sample data for demonstration
        function addSampleData() {
            const sampleData = [
                {
                    id: Date.now() - 3600000,
                    timestamp: new Date(Date.now() - 3600000),
                    type: 'sampel',
                    pemeriksaan: 'Hematologi',
                    parameter: ['Hemoglobin (Hb)', 'Leukosit', 'Trombosit'],
                    sampel: 'Darah Vena',
                    materials: {
                        BMHP: ['Alcohol swab 70%: 2 pcs', 'Spuit 3cc: 1 pcs', 'Vacutainer EDTA: 1 pcs', 'Plester hypoallergenic: 1 pcs', 'Kapas steril: 2 pcs', 'Tourniquet: 1 pcs', 'Sarung tangan pemeriksaan: 1 pasang'],
                        Reagen: ['Hematology Control: 0.05 ml', 'Hematology Lyse: 0.5 ml', 'Hematology Clean: 0.05 ml', 'Hematology Diluent: 36 ml']
                    },
                    pasien: {
                        nik: '3174014201030001',
                        nama: 'Siti Aminah',
                        gender: 'Perempuan',
                        birthDate: '02 Jan 2003',
                        age: '21 tahun',
                        province: 'DKI Jakarta',
                        city: 'Jakarta Selatan',
                        kecamatan: 'Kebayoran Baru',
                        alamat: 'Jl. Merdeka No. 10, RT 01/RW 05, Kelurahan Melawai',
                        telepon: '08123456789'
                    }
                },
                {
                    id: Date.now() - 86400000,
                    timestamp: new Date(Date.now() - 86400000),
                    type: 'control',
                    pemeriksaan: 'Kimia Darah',
                    parameter: ['Glukosa Puasa', 'Kolesterol Total', 'Trigliserida', 'Asam Urat', 'Ureum'],
                    sampel: 'Darah Vena',
                    materials: {
                        BMHP: ['Alcohol swab 70%: 2 pcs', 'Spuit 5cc: 1 pcs', 'Vacutainer clot activator: 1 pcs', 'Plester hypoallergenic: 1 pcs', 'Kapas steril: 2 pcs', 'Tourniquet: 1 pcs', 'Sarung tangan pemeriksaan: 1 pasang'],
                        Reagen: ['Reagen glukosa GOD-PAP: 1 ml', 'Reagen kolesterol CHOD-PAP: 1 ml', 'Reagen trigliserida GPO-PAP: 1 ml', 'Reagen asam urat: 1 ml', 'Reagen ureum: 1 ml']
                    }
                },
                {
                    id: Date.now() - 172800000,
                    timestamp: new Date(Date.now() - 172800000),
                    type: 'sampel',
                    pemeriksaan: 'Urinalisis',
                    parameter: ['pH', 'Berat Jenis', 'Protein', 'Glukosa', 'Keton', 'Darah Samar', 'Sedimen Urine'],
                    sampel: 'Urine',
                    materials: {
                        BMHP: ['Pot urine steril 50ml: 1 pcs', 'Label spesimen: 1 pcs', 'Tabung centrifuge 10ml: 1 pcs', 'Pipet tetes: 1 pcs', 'Object glass: 1 pcs', 'Cover glass: 1 pcs', 'Sarung tangan pemeriksaan: 1 pasang'],
                        Reagen: ['Urine strip 10 parameter: 1 pcs', 'Larutan SSA 20%: 2 ml', 'Asam asetat 3%: 2 ml']
                    },
                    pasien: {
                        nik: '3275012506950002',
                        nama: 'Ahmad Wijaya',
                        gender: 'Laki-laki',
                        birthDate: '25 Jun 1995',
                        age: '29 tahun',
                        province: 'Jawa Barat',
                        city: 'Bekasi',
                        kecamatan: 'Bekasi Barat',
                        alamat: 'Jl. Sudirman No. 45, RT 03/RW 08',
                        telepon: '08567891234'
                    }
                }
            ];

            pengeluaranData.push(...sampleData);
        }

        // Initialize with sample data
        addSampleData();
    </script>
</body>
</html>
